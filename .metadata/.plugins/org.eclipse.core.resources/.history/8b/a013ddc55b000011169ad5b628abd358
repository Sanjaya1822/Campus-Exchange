<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>
<%@ page import="com.campusexchange.db.DBConnection" %>

<%
    // SESSION CHECK
    HttpSession sess = request.getSession(false);
    if (sess == null || sess.getAttribute("userEmail") == null) {
        response.sendRedirect("login.jsp");
        return;
    }

    String userEmail = (String) sess.getAttribute("userEmail");
    Connection con = DBConnection.getConnection();
%>

<!DOCTYPE html>
<html>
<head>
    <title>My Items - CampusExchange</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <a href="dashboard.jsp">Dashboard</a>
    <a href="sell.jsp">Sell</a>
    <a href="myItems.jsp">My Items</a>
    <a href="logout">Logout</a>
</div>

<div class="auth-container">

    <h2 style="text-align:center;">My Items</h2>

    <h3 style="margin-top:25px;">Active Items</h3>

    <%
        PreparedStatement psActive = con.prepareStatement(
            "SELECT * FROM items WHERE seller_email=? AND status='AVAILABLE'"
        );
        psActive.setString(1, userEmail);
        ResultSet rsActive = psActive.executeQuery();

        boolean hasActive = false;
        while (rsActive.next()) {
            hasActive = true;
    %>
        <div class="item-card">
            <h4><%= rsActive.getString("title") %></h4>
            <p>₹ <%= rsActive.getDouble("price") %></p>
            <a href="itemDetails.jsp?id=<%= rsActive.getInt("id") %>">
                View Item
            </a>
        </div>
    <%
        }
        if (!hasActive) {
    %>
        <p style="color:gray;">No active items</p>
    <%
        }
    %>

    <h3 style="margin-top:35px;">Sold Items</h3>

    <%
        PreparedStatement psSold = con.prepareStatement(
            "SELECT * FROM items WHERE seller_email=? AND status='SOLD'"
        );
        psSold.setString(1, userEmail);
        ResultSet rsSold = psSold.executeQuery();

        boolean hasSold = false;
        while (rsSold.next()) {
            hasSold = true;
    %>
        <div class="item-card sold">
            <h4><%= rsSold.getString("title") %></h4>
            <p>₹ <%= rsSold.getDouble("price") %></p>
            <span style="color:red;">SOLD</span>
        </div>
    <%
        }
        if (!hasSold) {
    %>
        <p style="color:gray;">No sold items yet</p>
    <%
        }
    %>

</div>

<%
    con.close();
%>

</body>
</html>
